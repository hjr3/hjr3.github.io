<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">

    <title>How To Mock Functions That Have External HTTP Requests</title>
    <meta name="description" content="">

    <link rel="alternate" type="application/atom+xml" title="Atom feed" href="https://hermanradtke.com/atom.xml">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="me" href="https://hachyderm.io/@hjr3">

    <link rel="stylesheet" href="https://hermanradtke.com/main.css">
    <style>
      body {
        font-size: min(max(1em, 1.3vw), 1.3em);
      }

      a.zola-anchor {
        color: inherit;
      }
    </style>

    
    
        <link rel="alternate" type="application/atom+xml" title="Atom" href="https://hermanradtke.com/atom.xml">
    
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https://hermanradtke.com/rss.xml">
    
    

    
  <meta name="author" content="Herman J. Radtke III" />
  <meta name="description" content="&lt;p&gt;When writing tests, we do not want to hit the external API each time we run our tests. If we are coming from a dynamic language, such as Node.JS, we may want to a solution like &lt;a href=&quot;https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;fetch-mock&quot;&gt;fetch-mock&lt;&#x2F;a&gt; which will patch the implementation of &lt;code&gt;fetch&lt;&#x2F;code&gt; at runtime. This is not practical in Rust. There are some attempts, like the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Shizcow&#x2F;hotpatch&quot;&gt;hotpatch&lt;&#x2F;a&gt; crate, but we will use a different strategy.&lt;&#x2F;p&gt;
" />

  <meta property="og:locale" content="en_US" />
  <meta property="og:title" content="How To Mock Functions That Have External HTTP Requests" />
  <meta property="og:description" content="&lt;p&gt;When writing tests, we do not want to hit the external API each time we run our tests. If we are coming from a dynamic language, such as Node.JS, we may want to a solution like &lt;a href=&quot;https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;fetch-mock&quot;&gt;fetch-mock&lt;&#x2F;a&gt; which will patch the implementation of &lt;code&gt;fetch&lt;&#x2F;code&gt; at runtime. This is not practical in Rust. There are some attempts, like the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Shizcow&#x2F;hotpatch&quot;&gt;hotpatch&lt;&#x2F;a&gt; crate, but we will use a different strategy.&lt;&#x2F;p&gt;
" />
  <meta property="og:url" content="https://hermanradtke.com/how-to-mock-functions-that-have-external-http-requests/" />
  <meta property="og:site_name" content="Herman J. Radtke III Blog" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2022-04-23" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@hermanradtke" />
  <meta property="twitter:title" content="How To Mock Functions That Have External HTTP Requests" />
  <meta property="twitter:description" content="&lt;p&gt;When writing tests, we do not want to hit the external API each time we run our tests. If we are coming from a dynamic language, such as Node.JS, we may want to a solution like &lt;a href=&quot;https:&#x2F;&#x2F;www.npmjs.com&#x2F;package&#x2F;fetch-mock&quot;&gt;fetch-mock&lt;&#x2F;a&gt; which will patch the implementation of &lt;code&gt;fetch&lt;&#x2F;code&gt; at runtime. This is not practical in Rust. There are some attempts, like the &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;Shizcow&#x2F;hotpatch&quot;&gt;hotpatch&lt;&#x2F;a&gt; crate, but we will use a different strategy.&lt;&#x2F;p&gt;
" />
  <meta property="twitter:image" content="http://cdn.hermanradtke.com/glasses.jpg" />

  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:true});</script>

  <style>
    code {
      background-color: ghostwhite;
    }

    pre > code {
      background-color: transparent;
    }

    details > summary {
      display: list-item
    }
  </style>

</head>
<body>
    <a class="skip-main" href="#main">Skip to content</a>
    <div class="container">
        <header>
            <h1 class="site-header">
                <a href="https:&#x2F;&#x2F;hermanradtke.com">Herman J. Radtke III</a>
            </h1>
            <nav>
                
                
                
                <a  href="https:&#x2F;&#x2F;hermanradtke.com&#x2F;about">About</a>
                
                
                <a  href="https:&#x2F;&#x2F;hermanradtke.com&#x2F;projects">Projects</a>
                
                
                <a  href="https:&#x2F;&#x2F;hermanradtke.com&#x2F;talks">Talks</a>
                
                
                <a  href="https:&#x2F;&#x2F;hermanradtke.com&#x2F;tags">Tags</a>
                
                
                <a  href="https:&#x2F;&#x2F;hermanradtke.com&#x2F;links">Links</a>
                
                
                <a  href="https:&#x2F;&#x2F;hermanradtke.com&#x2F;atom.xml">Feed</a>
                
                
            </nav>
        </header>
        <main id="main" tabindex="-1">
            

<article class="post">
    <header>
        <h1>How To Mock Functions That Have External HTTP Requests</h1>
    </header>
    <div class="content">
        <p>When writing tests, we do not want to hit the external API each time we run our tests. If we are coming from a dynamic language, such as Node.JS, we may want to a solution like <a href="https://www.npmjs.com/package/fetch-mock">fetch-mock</a> which will patch the implementation of <code>fetch</code> at runtime. This is not practical in Rust. There are some attempts, like the <a href="https://github.com/Shizcow/hotpatch">hotpatch</a> crate, but we will use a different strategy.</p>
<span id="continue-reading"></span>
<p>The complete code for this post can be found at: <a href="https://github.com/hjr3/the-cat-api-http-mocks">https://github.com/hjr3/the-cat-api-http-mocks</a></p>
<h2 id="calling-the-cat-api"><a class="zola-anchor" href="#calling-the-cat-api" aria-label="Anchor link for: calling-the-cat-api">Calling The Cat API</a></h2>
<p>Let us start with an example. We will write a program to make search for cat breeds using <a href="https://docs.thecatapi.com/">The Cat API</a>. First, let us discover how this API works. Reading the docs for <a href="https://docs.thecatapi.com/api-reference/breeds/breeds-search">GET /breeds/search</a> we can search for breeds using the <code>q</code> query parameter. Using curl, we can try this out:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ curl https://api.thecatapi.com/v1/breeds/search?q=sib | jq
</span></code></pre>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>[
</span><span>  {
</span><span>    &quot;</span><span style="color:#a3be8c;">weight</span><span>&quot;: {
</span><span>      &quot;</span><span style="color:#a3be8c;">imperial</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">8 - 16</span><span>&quot;,
</span><span>      &quot;</span><span style="color:#a3be8c;">metric</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">4 - 7</span><span>&quot;
</span><span>    },
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">sibe</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">name</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">Siberian</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">cfa_url</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">http://cfa.org/Breeds/BreedsSthruT/Siberian.aspx</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">vetstreet_url</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">http://www.vetstreet.com/cats/siberian</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">vcahospitals_url</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">https://vcahospitals.com/know-your-pet/cat-breeds/siberian</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">temperament</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">Curious, Intelligent, Loyal, Sweet, Agile, Playful, Affectionate</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">origin</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">Russia</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">country_codes</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">RU</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">country_code</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">RU</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">description</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">The Siberians dog like temperament and affection makes the ideal lap cat and will live quite happily indoors. Very agile and powerful, the Siberian cat can easily leap and reach high places, including the tops of refrigerators and even doors. </span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">life_span</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">12 - 15</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">indoor</span><span>&quot;: </span><span style="color:#d08770;">0</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">lap</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">alt_names</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">Moscow Semi-longhair, HairSiberian Forest Cat</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">adaptability</span><span>&quot;: </span><span style="color:#d08770;">5</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">affection_level</span><span>&quot;: </span><span style="color:#d08770;">5</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">child_friendly</span><span>&quot;: </span><span style="color:#d08770;">4</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">dog_friendly</span><span>&quot;: </span><span style="color:#d08770;">5</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">energy_level</span><span>&quot;: </span><span style="color:#d08770;">5</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">grooming</span><span>&quot;: </span><span style="color:#d08770;">2</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">health_issues</span><span>&quot;: </span><span style="color:#d08770;">2</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">intelligence</span><span>&quot;: </span><span style="color:#d08770;">5</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">shedding_level</span><span>&quot;: </span><span style="color:#d08770;">3</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">social_needs</span><span>&quot;: </span><span style="color:#d08770;">4</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">stranger_friendly</span><span>&quot;: </span><span style="color:#d08770;">3</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">vocalisation</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">experimental</span><span>&quot;: </span><span style="color:#d08770;">0</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">hairless</span><span>&quot;: </span><span style="color:#d08770;">0</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">natural</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">rare</span><span>&quot;: </span><span style="color:#d08770;">0</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">rex</span><span>&quot;: </span><span style="color:#d08770;">0</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">suppressed_tail</span><span>&quot;: </span><span style="color:#d08770;">0</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">short_legs</span><span>&quot;: </span><span style="color:#d08770;">0</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">wikipedia_url</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">https://en.wikipedia.org/wiki/Siberian_(cat)</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">hypoallergenic</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">reference_image_id</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">3bkZAjRh1</span><span>&quot;
</span><span>  }
</span><span>]
</span></code></pre>
<p>Now that we know how to make a request and what the shape of the response looks like, we can write a program. We will use the reqwest crate to make our HTTP requests. I will opt for blocking behavior to avoid any async type juggling.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">use </span><span>serde::Deserialize;
</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Deserialize)]
</span><span style="color:#b48ead;">struct </span><span>Breed {
</span><span>    </span><span style="color:#bf616a;">id</span><span>: String,
</span><span>    </span><span style="color:#bf616a;">name</span><span>: String,
</span><span>}
</span><span>
</span><span style="color:#b48ead;">type </span><span>BreedResponse = Vec&lt;Breed&gt;;
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(</span><span style="color:#bf616a;">query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>    </span><span style="color:#b48ead;">let</span><span> url = format!(&quot;</span><span style="color:#a3be8c;">https://api.thecatapi.com/v1/breeds/search?q=</span><span style="color:#d08770;">{}</span><span>&quot;, query);
</span><span>    </span><span style="color:#b48ead;">let</span><span> resp = reqwest::blocking::get(url)?.json::&lt;BreedResponse&gt;()?;
</span><span>
</span><span>    Ok(resp)
</span><span>}
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>    </span><span style="color:#b48ead;">let</span><span> resp = </span><span style="color:#96b5b4;">search_breeds</span><span>(&quot;</span><span style="color:#a3be8c;">sib</span><span>&quot;)?;
</span><span>    println!(&quot;</span><span style="color:#d08770;">{:#?}</span><span>&quot;, resp);
</span><span>    Ok(())
</span><span>}
</span></code></pre>
<p>Note: The serde_json crate allows us to define a subset of the response. I only specified a few fields in <code>Breed</code> for brevity.</p>
<p>If we run our program, we should see something like:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ cargo run
</span><span>[
</span><span>    Breed {
</span><span>        id: &quot;sibe&quot;,
</span><span>        name: &quot;Siberian&quot;,
</span><span>    },
</span><span>]
</span></code></pre>
<h2 id="create-mocks-using-traits"><a class="zola-anchor" href="#create-mocks-using-traits" aria-label="Anchor link for: create-mocks-using-traits">Create Mocks Using Traits</a></h2>
<p>Now, we want to test our program without making an actual HTTP request. We can use a <a href="https://doc.rust-lang.org/book/ch10-02-traits.html">trait</a> to define the types of requests we can make. We will define a trait called <code>TheCatApi</code> and then implement a concrete <code>TheCatApiClient</code> type.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">trait </span><span>TheCatApi {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt;;
</span><span>}
</span><span>
</span><span style="color:#b48ead;">struct </span><span>TheCatApiClient {}
</span><span style="color:#b48ead;">impl </span><span>TheCatApi </span><span style="color:#b48ead;">for </span><span>TheCatApiClient {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>        </span><span style="color:#b48ead;">let</span><span> url = format!(&quot;</span><span style="color:#a3be8c;">https://api.thecatapi.com/v1/breeds/search?q=</span><span style="color:#d08770;">{}</span><span>&quot;, query);
</span><span>        </span><span style="color:#b48ead;">let</span><span> resp = reqwest::blocking::get(url)?.json::&lt;BreedResponse&gt;()?;
</span><span>
</span><span>        Ok(resp)
</span><span>    }
</span><span>}
</span></code></pre>
<p>Now our main function looks like this:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>    </span><span style="color:#b48ead;">let</span><span> client = TheCatApiClient {};
</span><span>    </span><span style="color:#b48ead;">let</span><span> resp = client.</span><span style="color:#96b5b4;">search_breeds</span><span>(&quot;</span><span style="color:#a3be8c;">sib</span><span>&quot;)?;
</span><span>    println!(&quot;</span><span style="color:#d08770;">{:#?}</span><span>&quot;, resp);
</span><span>
</span><span>    Ok(())
</span><span>}
</span></code></pre>
<p>If we run our program, we should get the same output above.</p>
<p>Now that we have a <code>TheCatApi</code> trait, we can also implement a mock client. We use the output from our curl request above and implement the <code>search_breeds</code> function to deserialize the JSON.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">struct </span><span>TheCatApiClientMock {}
</span><span>
</span><span style="color:#b48ead;">impl </span><span>TheCatApi </span><span style="color:#b48ead;">for </span><span>TheCatApiClientMock {
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">_query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>        </span><span style="color:#b48ead;">let</span><span> data = </span><span style="color:#b48ead;">r</span><span>#&quot;
</span><span style="color:#a3be8c;">            [
</span><span style="color:#a3be8c;">              {
</span><span style="color:#a3be8c;">                &quot;weight&quot;: {
</span><span style="color:#a3be8c;">                  &quot;imperial&quot;: &quot;8 - 16&quot;,
</span><span style="color:#a3be8c;">                  &quot;metric&quot;: &quot;4 - 7&quot;
</span><span style="color:#a3be8c;">                },
</span><span style="color:#a3be8c;">                &quot;id&quot;: &quot;sibe&quot;,
</span><span style="color:#a3be8c;">                &quot;name&quot;: &quot;Siberian&quot;,
</span><span style="color:#a3be8c;">                &quot;cfa_url&quot;: &quot;http://cfa.org/Breeds/BreedsSthruT/Siberian.aspx&quot;,
</span><span style="color:#a3be8c;">                &quot;vetstreet_url&quot;: &quot;http://www.vetstreet.com/cats/siberian&quot;,
</span><span style="color:#a3be8c;">                &quot;vcahospitals_url&quot;: &quot;https://vcahospitals.com/know-your-pet/cat-breeds/siberian&quot;,
</span><span style="color:#a3be8c;">                &quot;temperament&quot;: &quot;Curious, Intelligent, Loyal, Sweet, Agile, Playful, Affectionate&quot;,
</span><span style="color:#a3be8c;">                &quot;origin&quot;: &quot;Russia&quot;,
</span><span style="color:#a3be8c;">                &quot;country_codes&quot;: &quot;RU&quot;,
</span><span style="color:#a3be8c;">                &quot;country_code&quot;: &quot;RU&quot;,
</span><span style="color:#a3be8c;">                &quot;description&quot;: &quot;The Siberians dog like temperament and affection makes the ideal lap cat and will live quite happily indoors. Very agile and powerful, the Siberian cat can easily leap and reach high places, including the tops of refrigerators and even doors. &quot;,
</span><span style="color:#a3be8c;">                &quot;life_span&quot;: &quot;12 - 15&quot;,
</span><span style="color:#a3be8c;">                &quot;indoor&quot;: 0,
</span><span style="color:#a3be8c;">                &quot;lap&quot;: 1,
</span><span style="color:#a3be8c;">                &quot;alt_names&quot;: &quot;Moscow Semi-longhair, HairSiberian Forest Cat&quot;,
</span><span style="color:#a3be8c;">                &quot;adaptability&quot;: 5,
</span><span style="color:#a3be8c;">                &quot;affection_level&quot;: 5,
</span><span style="color:#a3be8c;">                &quot;child_friendly&quot;: 4,
</span><span style="color:#a3be8c;">                &quot;dog_friendly&quot;: 5,
</span><span style="color:#a3be8c;">                &quot;energy_level&quot;: 5,
</span><span style="color:#a3be8c;">                &quot;grooming&quot;: 2,
</span><span style="color:#a3be8c;">                &quot;health_issues&quot;: 2,
</span><span style="color:#a3be8c;">                &quot;intelligence&quot;: 5,
</span><span style="color:#a3be8c;">                &quot;shedding_level&quot;: 3,
</span><span style="color:#a3be8c;">                &quot;social_needs&quot;: 4,
</span><span style="color:#a3be8c;">                &quot;stranger_friendly&quot;: 3,
</span><span style="color:#a3be8c;">                &quot;vocalisation&quot;: 1,
</span><span style="color:#a3be8c;">                &quot;experimental&quot;: 0,
</span><span style="color:#a3be8c;">                &quot;hairless&quot;: 0,
</span><span style="color:#a3be8c;">                &quot;natural&quot;: 1,
</span><span style="color:#a3be8c;">                &quot;rare&quot;: 0,
</span><span style="color:#a3be8c;">                &quot;rex&quot;: 0,
</span><span style="color:#a3be8c;">                &quot;suppressed_tail&quot;: 0,
</span><span style="color:#a3be8c;">                &quot;short_legs&quot;: 0,
</span><span style="color:#a3be8c;">                &quot;wikipedia_url&quot;: &quot;https://en.wikipedia.org/wiki/Siberian_(cat)&quot;,
</span><span style="color:#a3be8c;">                &quot;hypoallergenic&quot;: 1,
</span><span style="color:#a3be8c;">                &quot;reference_image_id&quot;: &quot;3bkZAjRh1&quot;
</span><span style="color:#a3be8c;">              }
</span><span style="color:#a3be8c;">            ]
</span><span style="color:#a3be8c;">        </span><span>&quot;#;
</span><span>
</span><span>        </span><span style="color:#b48ead;">let</span><span> resp: BreedResponse = serde_json::from_str(data)?;
</span><span>
</span><span>        Ok(resp)
</span><span>    }
</span><span>}
</span></code></pre>
<p>You can also shorten this up by doing <code>BreedResponse { id: "sibe", name: "Siberian" }</code> but for real world examples I find it easier to paste the JSON string.</p>
<p>Now we can wire up some tests. In this simple case, we are only testing that we implemented the <code>BreedResponse</code> type and <code>Breed</code> struct correctly.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">test</span><span>]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>() {
</span><span>    </span><span style="color:#b48ead;">struct </span><span>TheCatApiClientMock {}
</span><span>    </span><span style="color:#b48ead;">impl </span><span>TheCatApi </span><span style="color:#b48ead;">for </span><span>TheCatApiClientMock {
</span><span>        </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(
</span><span>            &amp;</span><span style="color:#bf616a;">self</span><span>,
</span><span>            </span><span style="color:#bf616a;">_query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>,
</span><span>        ) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>           </span><span style="color:#65737e;">// removed for brevity. use implementation above
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> client = TheCatApiClientMock {};
</span><span>    </span><span style="color:#b48ead;">let</span><span> resp = client
</span><span>        .</span><span style="color:#96b5b4;">search_breeds</span><span>(&quot;</span><span style="color:#a3be8c;">does not matter what i put</span><span>&quot;)
</span><span>        .</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">search_breeds failed</span><span>&quot;);
</span><span>    assert_eq!(resp[</span><span style="color:#d08770;">0</span><span>].id, &quot;</span><span style="color:#a3be8c;">sibe</span><span>&quot;);
</span><span>    assert_eq!(resp[</span><span style="color:#d08770;">0</span><span>].name, &quot;</span><span style="color:#a3be8c;">Siberian</span><span>&quot;);
</span><span>}
</span></code></pre>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>$ cargo test
</span><span>    Finished test [unoptimized + debuginfo] target(s) in 0.15s
</span><span>     Running unittests src/main.rs (target/debug/deps/rust_mocks-aa82d6388d1da1bd)
</span><span>
</span><span>running 1 test
</span><span>test tests::search_breeds ... ok
</span><span>
</span><span>test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</span></code></pre>
<p>And we should also test a decoding failure to make sure we are testing what we expect.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">test</span><span>]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds_decode_error</span><span>() {
</span><span>    </span><span style="color:#b48ead;">struct </span><span>TheCatApiClientMock {}
</span><span>    </span><span style="color:#b48ead;">impl </span><span>TheCatApi </span><span style="color:#b48ead;">for </span><span>TheCatApiClientMock {
</span><span>        </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(
</span><span>            &amp;</span><span style="color:#bf616a;">self</span><span>,
</span><span>            </span><span style="color:#bf616a;">_query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>,
</span><span>        ) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>            </span><span style="color:#b48ead;">let</span><span> data = &quot;</span><span style="color:#a3be8c;">nope</span><span>&quot;;
</span><span>
</span><span>            </span><span style="color:#b48ead;">let</span><span> resp: BreedResponse = serde_json::from_str(data)?;
</span><span>
</span><span>            Ok(resp)
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> client = TheCatApiClientMock {};
</span><span>    </span><span style="color:#b48ead;">let</span><span> err = client
</span><span>        .</span><span style="color:#96b5b4;">search_breeds</span><span>(&quot;</span><span style="color:#a3be8c;">does not matter what i put</span><span>&quot;)
</span><span>        .</span><span style="color:#96b5b4;">unwrap_err</span><span>();
</span><span>    assert_eq!(err.</span><span style="color:#96b5b4;">to_string</span><span>(), &quot;</span><span style="color:#a3be8c;">expected ident at line 2 column 18</span><span>&quot;);
</span><span>}
</span></code></pre>
<p>Notice that I put the mock client implementation inside the test function. If we define it outside the test function, then each mock needs a unique name.</p>
<h2 id="injecting-traits-as-dependencies"><a class="zola-anchor" href="#injecting-traits-as-dependencies" aria-label="Anchor link for: injecting-traits-as-dependencies">Injecting Traits As Dependencies</a></h2>
<p>This is all good but we have side stepped a big part of implementing this strategy in a real program. A big reason people reach for testing libraries like <a href="https://www.npmjs.com/package/fetch-mock">fetch-mock</a> is because they have no other way to tell their function to use a different implementation of fetch. Indeed, we need to structure our program to inject dependencies. I mostly write web servers, so let us create a simple web server for a more real world example. Our web server will accept a request to search for breeds and then use our implementation of <code>TheCatApi</code> trait get the data. I am going to use <a href="https://rocket.rs">rocket.rs</a> as it has really good docs. I will also be using the v0.4 version, which is blocking. Be aware that the v0.4 version requires the nightly compiler.</p>
<p>When we create our web server, we want to inject our dependencies. Specifically, we want to inject <code>TheCatApiClient</code>. We can do this in rocket.rs by using the <a href="https://api.rocket.rs/v0.4/rocket/struct.Rocket.html#method.manage">manage</a> method. This will allow us to access the client from the request handler.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> the_cat_api_client = TheCatApiClient {};
</span><span>
</span><span>    rocket::ignite()
</span><span>         </span><span style="color:#65737e;">// we inject our dependency here
</span><span>        .</span><span style="color:#96b5b4;">manage</span><span>(the_cat_api_client)
</span><span>        .</span><span style="color:#96b5b4;">mount</span><span>(&quot;</span><span style="color:#a3be8c;">/</span><span>&quot;, routes![index, get_breed])
</span><span>        .</span><span style="color:#96b5b4;">launch</span><span>();
</span><span>}
</span><span>
</span><span>#[</span><span style="color:#bf616a;">get</span><span>(&quot;</span><span style="color:#a3be8c;">/breed?&lt;search&gt;</span><span>&quot;)]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">get_breed</span><span>(
</span><span>    </span><span style="color:#65737e;">// we access our dependency here
</span><span>    </span><span style="color:#bf616a;">client</span><span>: State&lt;TheCatApiClient&gt;,
</span><span>    </span><span style="color:#bf616a;">search</span><span>: &amp;RawStr,
</span><span>) -&gt; Result&lt;String, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>    </span><span style="color:#b48ead;">let</span><span> resp = client.</span><span style="color:#96b5b4;">inner</span><span>().</span><span style="color:#96b5b4;">search_breeds</span><span>(search)?;
</span><span>
</span><span>    Ok(resp[</span><span style="color:#d08770;">0</span><span>].name.</span><span style="color:#96b5b4;">clone</span><span>())
</span><span>}
</span></code></pre>
<p>Now we can run our server</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>cargo run
</span><span>   Compiling rust-mocks v0.1.0 (/Users/herman/Code/rust-mocks)
</span><span>    Finished dev [unoptimized + debuginfo] target(s) in 2.10s
</span><span>     Running `target/debug/rust-mocks`
</span><span>🔧 Configured for development.
</span><span>    =&gt; address: localhost
</span><span>    =&gt; port: 8000
</span><span>    =&gt; log: normal
</span><span>    =&gt; workers: 16
</span><span>    =&gt; secret key: generated
</span><span>    =&gt; limits: forms = 32KiB
</span><span>    =&gt; keep-alive: 5s
</span><span>    =&gt; read timeout: 5s
</span><span>    =&gt; write timeout: 5s
</span><span>    =&gt; tls: disabled
</span><span>🛰  Mounting /:
</span><span>    =&gt; GET /breed?&lt;search&gt; (get_breed)
</span><span>🚀 Rocket has launched from http://localhost:8000
</span></code></pre>
<p>and make a request</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>$ curl &#39;localhost:</span><span style="color:#d08770;">8000</span><span>/breed?search=cal&#39;
</span><span>California Spangled
</span></code></pre>
<p>Now that we have a working web server that makes requests to The Cat API, we want to write a test for our <code>get_breed</code> handler. The rocket.rs framework makes this fairly straight-forward as <code>client</code> is a parameter to <code>get_breeds</code>. We will need to change the type of client from the concrete implementation of <code>TheCatApiClient</code> to a type that will allow us to use any implementation of the <code>TheCatApi</code> trait. There are two ways to do this: generics and boxed traits. Unfortunately, rocket.rs does not allow us to use generic functions. If we try to write a generic function, then we will get a compiler error.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">get</span><span>(&quot;</span><span style="color:#a3be8c;">/breed?&lt;search&gt;</span><span>&quot;)]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">get_breed</span><span>&lt;T: TheCataApi&gt;(
</span><span>    </span><span style="color:#bf616a;">client</span><span>: State&lt;T&gt;, </span><span style="color:#65737e;">// &lt;---- compiler error here
</span><span>    </span><span style="color:#bf616a;">search</span><span>: &amp;RawStr,
</span><span>) -&gt; Result&lt;String, Box&lt;dyn std::error::Error&gt;&gt; {}
</span></code></pre>
<p>So, boxed traits it is! We only create one instance of our API client when our program runs, so it creating our client on the stack or heap does not make much of a difference.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">get</span><span>(&quot;</span><span style="color:#a3be8c;">/breed?&lt;search&gt;</span><span>&quot;)]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">get_breed</span><span>(
</span><span>    </span><span style="color:#bf616a;">client</span><span>: State&lt;Box&lt;dyn TheCatApi&gt;&gt;,
</span><span>    </span><span style="color:#bf616a;">search</span><span>: &amp;RawStr,
</span><span>) -&gt; Result&lt;String, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>    </span><span style="color:#b48ead;">let</span><span> resp = client.</span><span style="color:#96b5b4;">inner</span><span>().</span><span style="color:#96b5b4;">search_breeds</span><span>(search)?;
</span><span>
</span><span>    Ok(resp[</span><span style="color:#d08770;">0</span><span>].name.</span><span style="color:#96b5b4;">clone</span><span>())
</span><span>}
</span></code></pre>
<p>We need to update our main function as well.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> the_cat_api_client = Box::new(TheCatApiClient {});
</span><span>
</span><span>    rocket::ignite()
</span><span>        .</span><span style="color:#96b5b4;">manage</span><span>(the_cat_api_client)
</span><span>        .</span><span style="color:#96b5b4;">mount</span><span>(&quot;</span><span style="color:#a3be8c;">/</span><span>&quot;, routes![index, get_breed])
</span><span>        .</span><span style="color:#96b5b4;">launch</span><span>();
</span><span>}
</span></code></pre>
<p>Now our <code>get_breed</code> function can accept any implementation of <code>TheCatApi</code> trait. We have one more thing to do before we can write our test. Notice that the <code>client</code> type in <code>get_breed</code> is <code>State&lt;Box&lt;dyn TheCatApi&gt;&gt;</code>. We need some way of creating that <code>State</code> type. The rocket.rs docs have a <a href="https://api.rocket.rs/v0.4/rocket/request/struct.State.html#testing-with-state">Testing with <code>State</code></a> section that gives us the hint. So, to make this work we will need to extract the set up logic for our web server out of the <code>main</code> function. We create a <code>setup</code> function that allows us to pass in an implementation of <code>TheCatApi</code> trait.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">setup</span><span>(</span><span style="color:#bf616a;">the_cat_api</span><span>: Box&lt;dyn TheCatApi&gt;) -&gt; Rocket {
</span><span>    rocket::ignite()
</span><span>        .</span><span style="color:#96b5b4;">manage</span><span>(the_cat_api)
</span><span>        .</span><span style="color:#96b5b4;">mount</span><span>(&quot;</span><span style="color:#a3be8c;">/</span><span>&quot;, routes![index, get_breed])
</span><span>}
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">let</span><span> the_cat_api_client = Box::new(TheCatApiClient {});
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> rocket = </span><span style="color:#96b5b4;">setup</span><span>(the_cat_api_client);
</span><span>    rocket.</span><span style="color:#96b5b4;">launch</span><span>();
</span><span>}
</span></code></pre>
<p>With that in place, we can write a test that allows us to ensure <code>get_breed</code> succeeds.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">test</span><span>]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">breed_succeeds</span><span>() {
</span><span>    </span><span style="color:#b48ead;">struct </span><span>TheCatApiClientMock {}
</span><span>    </span><span style="color:#b48ead;">impl </span><span>TheCatApi </span><span style="color:#b48ead;">for </span><span>TheCatApiClientMock {
</span><span>        </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(
</span><span>            &amp;</span><span style="color:#bf616a;">self</span><span>,
</span><span>            </span><span style="color:#bf616a;">query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>,
</span><span>        ) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>
</span><span>            </span><span style="color:#65737e;">// removed for brevity. use implementation above
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#65737e;">// create our mock client
</span><span>    </span><span style="color:#b48ead;">let</span><span> mock_client = Box::new(TheCatApiClientMock {});
</span><span>
</span><span>    </span><span style="color:#65737e;">// inject it into our web server
</span><span>    </span><span style="color:#b48ead;">let</span><span> rocket = </span><span style="color:#96b5b4;">setup</span><span>(mock_client);
</span><span>
</span><span>    </span><span style="color:#65737e;">// get our state
</span><span>    </span><span style="color:#b48ead;">let</span><span> state: State&lt;Box&lt;dyn TheCatApi&gt;&gt; =
</span><span>        State::from(&amp;rocket).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">managing `TheCatApiClientMock`</span><span>&quot;);
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> resp = </span><span style="color:#96b5b4;">get_breed</span><span>(state, RawStr::from_str(&quot;</span><span style="color:#a3be8c;">sib</span><span>&quot;)).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">get_breed failed</span><span>&quot;);
</span><span>    assert_eq!(resp, &quot;</span><span style="color:#a3be8c;">Siberian</span><span>&quot;);
</span><span>}
</span></code></pre>
<p>We can also create a mock client that fails.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">test</span><span>]
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">breed_decode_error</span><span>() {
</span><span>    </span><span style="color:#b48ead;">struct </span><span>TheCatApiClientMock {}
</span><span>    </span><span style="color:#b48ead;">impl </span><span>TheCatApi </span><span style="color:#b48ead;">for </span><span>TheCatApiClientMock {
</span><span>        </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">search_breeds</span><span>(
</span><span>            &amp;</span><span style="color:#bf616a;">self</span><span>,
</span><span>            </span><span style="color:#bf616a;">_query</span><span>: &amp;</span><span style="color:#b48ead;">str</span><span>,
</span><span>        ) -&gt; Result&lt;BreedResponse, Box&lt;dyn std::error::Error&gt;&gt; {
</span><span>            </span><span style="color:#b48ead;">let</span><span> data = &quot;</span><span style="color:#a3be8c;">nope</span><span>&quot;;
</span><span>
</span><span>            </span><span style="color:#b48ead;">let</span><span> resp: BreedResponse = serde_json::from_str(data)?;
</span><span>
</span><span>            Ok(resp)
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> mock_client = Box::new(TheCatApiClientMock {});
</span><span>    </span><span style="color:#b48ead;">let</span><span> rocket = </span><span style="color:#96b5b4;">setup</span><span>(mock_client);
</span><span>    </span><span style="color:#b48ead;">let</span><span> state: State&lt;Box&lt;dyn TheCatApi&gt;&gt; =
</span><span>        State::from(&amp;rocket).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">managing `TheCatApiClientMock`</span><span>&quot;);
</span><span>    </span><span style="color:#b48ead;">let</span><span> err = </span><span style="color:#96b5b4;">get_breed</span><span>(state, RawStr::from_str(&quot;</span><span style="color:#a3be8c;">sib</span><span>&quot;)).</span><span style="color:#96b5b4;">unwrap_err</span><span>();
</span><span>    assert_eq!(err.</span><span style="color:#96b5b4;">to_string</span><span>(), &quot;</span><span style="color:#a3be8c;">expected ident at line 1 column 2</span><span>&quot;);
</span><span>}
</span></code></pre>
<h2 id="further-discussion"><a class="zola-anchor" href="#further-discussion" aria-label="Anchor link for: further-discussion">Further Discussion</a></h2>
<p>Structuring our application this way makes it easier to inject dependencies. I tend to inject any dependency that is accessing the network or file system. This includes common parts of a web server like databases, loggers, tracing and API clients. The benefits go beyond testing.</p>
<p>When serverless computing came onto the scene, many developers would write their serverless function in such a way that it could only run in the cloud. This created painfully long dev cycles where each change would take 30 seconds to upload to the cloud to verify. Some folks reached for complex solutions like <a href="https://www.serverless.com/">serverles framework</a> that tried to emulate the behavior of the cloud. It may have been better to design the application to accept a <code>Server</code> trait. We could implement that trait to work for <a href="https://hyper.rs/">hyper.rs</a> and to work for the cloud implementation. Our dev cycle is now much faster and has less complexity than an emulated system.</p>
<p>This starts to look like <a href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)">Hexagonal architecture</a>. We define traits for our network and filesystem dependencies so we can change the behavior of the system. Do not go overboard on this pattern. I tend to implement a trait when the need arises. I also like the <a href="https://www.destroyallsoftware.com/talks/boundaries">Boundaries</a> talk by Gary Bernhardt.</p>
<h2 id="criticism-and-alternatives"><a class="zola-anchor" href="#criticism-and-alternatives" aria-label="Anchor link for: criticism-and-alternatives">Criticism and Alternatives</a></h2>
<p>One downside to this approach is that we are not testing the actual implementation of <code>search_breeds</code>. We may have a bug in our code that does not show up in our tests. It is important that we keep our <code>search_breeds</code> function as small as possible to mitigate this downside.</p>
<p>If testing the actual implementation of <code>search_breeds</code> is a real concern, then we want to reach for libraries like <a href="https://github.com/ggriffiniii/httptest">httptest</a>. This will define a local web server that can be configured to return specific responses. If we have other types of dependencies, like a database, then we can look for an in-memory implementation of that database. There is no silver bullet solution, so pick the option that best suits your needs.</p>

    </div>

    
    <div class="article-info">
        
        <div class="article-date">April, 23 2022</div>
        
        <div class="article-taxonomies">
            
            
                <ul class="article-tags">
                    
                    <li><a href="https://hermanradtke.com/tags/rustlang/">#rustlang</a></li>
                    
                </ul>
            
        </div>
    </div>

</article>



        </main>
        <footer>
          

<p>
<div class="twitter">
  If you enjoyed this post, please share it with your followers on 
  <!-- Medium Fediverse Share -->
  <!--        AGPLv3.0        -->
  <div class="fedi-share fedi-share-md">
  	<input type="checkbox" class="fedi-check-toggle">
  	<div class="fedi-instance">
  		<span>Instance: </span>
  		<input type="textbox" name="fedi-instance-input" placeholder="social.uden.ai">
  		<button class="fedi-share-button">Share</button>
  	</div>
  	<label class="fedi-top fedi-check-label">
  		<!-- CC BY-SA 4.0 - Erik Uden -->
  		<img src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='761' height='188' version='1.1' viewBox='0 0 713 176' xmlns='http://www.w3.org/2000/svg'%3E%3Cg%3E%3Cg transform='matrix(1.0065 0 0 1.0126 -4.299 -8.0083)'%3E%3Cg transform='translate(6.679 -32.496)' shape-rendering='auto'%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m181.13 275.14a68.892 68.892 0 0 1-29.465 29.328l161.76 162.39 38.998-19.764zm213.36 214.19-38.998 19.764 81.963 82.283a68.892 68.892 0 0 1 29.471-29.332z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23a730b8' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m581.65 339.39-91.576 46.41 6.752 43.189 103.62-52.514a68.892 68.892 0 0 1-18.791-37.086zm-144.74 73.352-216.53 109.73a68.892 68.892 0 0 1 18.795 37.09l204.48-103.63z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%235496be' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m367.28 142.44-104.48 203.97 30.848 30.967 110.62-215.96a68.892 68.892 0 0 1-36.99-18.98zm-131.65 257.02-52.922 103.31a68.892 68.892 0 0 1 36.986 18.979l46.781-91.328z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23ce3d1a' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m150.77 304.92a68.892 68.892 0 0 1-34.416 7.1953 68.892 68.892 0 0 1-6.6504-0.69531l30.902 197.66a68.892 68.892 0 0 1 34.416-7.1953 68.892 68.892 0 0 1 6.6465 0.69531z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23d0188f' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m239.34 560.54a68.892 68.892 0 0 1 0.7207 13.877 68.892 68.892 0 0 1-7.2676 27.18l197.63 31.713a68.892 68.892 0 0 1-0.72266-13.879 68.892 68.892 0 0 1 7.2695-27.178z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%235b36e9' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m601.13 377.2-91.219 178.08a68.892 68.892 0 0 1 36.994 18.982l91.217-178.08a68.892 68.892 0 0 1-36.992-18.984z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%2330b873' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m347.79 104.63-178.58 90.498a68.892 68.892 0 0 1 18.793 37.086l178.57-90.502a68.892 68.892 0 0 1-18.791-37.082z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23f47601' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m188.13 232.97a68.892 68.892 0 0 1 0.75781 14.096 68.892 68.892 0 0 1-7.1602 26.982l101.37 16.281 19.924-38.908zm173.74 27.9-19.926 38.912 239.51 38.467a68.892 68.892 0 0 1-0.69531-13.719 68.892 68.892 0 0 1 7.3496-27.324z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23dbb210' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3C/g%3E%3Cg transform='translate(6.679 -32.496)' fill-opacity='.99597'%3E%3Ccircle transform='rotate(3.1178)' cx='106.27' cy='51.536' r='16.571' fill='%23ffca00'/%3E%3Cellipse transform='rotate(3.1178)' cx='171.43' cy='110.19' rx='16.571' ry='16.571' fill='%2364ff00'/%3E%3Ccircle transform='rotate(3.1178)' cx='135.76' cy='190.28' r='16.571' fill='%2300a3ff'/%3E%3Ccircle transform='rotate(3.1178)' cx='48.559' cy='181.11' r='16.571' fill='%239500ff'/%3E%3Ccircle transform='rotate(3.1178)' cx='30.329' cy='95.367' r='16.571' fill='%23f00'/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3Cg%3E%3Cpath d='m278.65 36.85c0.0288 10.885-0.0659 21.771 0.0645 32.656-3.996-4.827-10.049-7.6252-16.212-8.3057-6.8052-0.77851-14.056 0.21213-19.867 4.0309-5.9801 3.8707-9.9252 10.248-11.993 16.958-2.411 7.794-2.802 16.066-2.3596 24.165 0.48519 7.9431 2.177 16.054 6.5016 22.847 3.067 4.8895 7.7698 8.8212 13.323 10.532 5.2205 1.6423 10.847 1.565 16.19 0.60228 5.4256-1.0214 10.628-3.7058 14.176-7.9988 0.42516-0.62893 0.69809-0.84874 0.62923 0.0916 0.23019 2.4246 0.452 4.8647 1.0894 7.2237h21.965c-0.43701-7.3688-0.72844-14.749-0.64844-22.132v-82.544h-22.857v1.873zm38.562 0v9.3927a6.5585 6.5585 45 0 0 6.5585 6.5585h10.092a6.2071 6.2071 135 0 0 6.2071-6.2071v-5.0001a6.617 6.617 45 0 0-6.617-6.617h-14.367a1.873 1.873 135 0 0-1.873 1.873zm-248.04 5.0996v89.464a8.2395 8.2395 45 0 0 8.2395 8.2395h7.8625a7.7066 7.7066 135 0 0 7.7066-7.7066v-22.255a5.2001 5.2001 135 0 1 5.2001-5.2001h37.059a6.778 6.778 135 0 0 6.778-6.778v-5.6833a6.7907 6.7907 45 0 0-6.7907-6.7907h-37.36a4.886 4.886 45 0 1-4.886-4.886v-17.479a3.5427 3.5427 135 0 1 3.5427-3.5427h38.695a8.3641 8.3641 135 0 0 8.3641-8.3641v-2.7356a8.1542 8.1542 45 0 0-8.1542-8.1542h-64.383a1.873 1.873 135 0 0-1.873 1.873zm479.96 18.939c-3.7809-0.0275-7.6926 0.88342-10.686 3.2949-2.5218 1.9808-4.2834 4.7458-5.6172 7.625-0.17472-3.1697-0.33016-6.3442-0.75976-9.4922h-21.885c0.4839 7.509 0.72676 15.033 0.66211 22.558v54.778h22.857c0.0148-13.173-0.0297-26.347 0.0225-39.52 0.15909-4.7901 0.74175-9.7851 3.2328-13.982 1.7322-2.9181 4.775-5.0812 8.1895-5.418 3.9852-0.42238 7.9412 0.52408 11.815 1.3439v-19.553c-2.0484-0.96187-4.2674-1.5417-6.5346-1.6028-0.43172-0.0285-0.86523-0.023-1.2975-0.032zm45.18 0.0234c-7.1066 0.20062-14.439 1.386-20.605 5.123-4.3887 2.6295-7.9783 6.7396-9.4823 11.678-1.3642 4.4444-1.4253 9.2816-0.27163 13.779 0.98425 3.8299 3.3142 7.2225 6.3588 9.7155 3.1621 2.6705 6.9918 4.4071 10.94 5.5613 6.2111 1.9276 12.615 3.1099 18.96 4.4934 2.8017 0.73524 5.7948 1.4686 7.9974 3.4645 1.6718 1.6133 1.6811 4.4079 0.55407 6.3256-1.3829 2.0894-4.026 2.6986-6.3399 3.1192-3.1029 0.48988-6.2605 0.50696-9.3923 0.36917-0.46482-0.0248-1.2762-0.0815-1.8748-0.14163-2.679-0.32171-5.6459-0.69427-7.6486-2.6943-1.87-1.845-2.5943-4.4445-3.2715-6.9004-6.8411 1.025-13.683 2.048-20.523 3.0742 0.92636 3.482 1.9879 6.9846 3.9419 10.047 2.8838 4.7706 7.5191 8.3679 12.758 10.216 6.9578 2.5152 14.46 2.9735 21.799 2.8405 7.4178-0.23023 15.054-1.4978 21.504-5.3659 4.6991-2.7748 8.5968-7.1418 10.139-12.443 1.2719-4.2984 1.2565-8.9379 0.25399-13.289-1.3731-5.6352-5.4925-10.357-10.55-13.067-5.0852-2.7758-10.788-4.0639-16.354-5.4924-3.9266-0.99991-7.909-1.7089-11.832-2.66-2.0101-0.59619-4.1818-1.1425-5.7565-2.6068-1.4918-1.5032-1.5101-4.0729-0.42383-5.8047 1.2851-1.6472 3.4802-2.1179 5.4269-2.4963 3.5021-0.52049 7.102-0.57889 10.6 1.8e-4 2.4824 0.40383 5.0254 1.6144 6.2258 3.9389 0.83078 1.4492 1.0345 3.1282 1.3739 4.7349 6.9101-0.72299 13.82-1.445 20.73-2.166-0.68806-3.3149-1.5142-6.6597-3.243-9.6066-3.1178-5.6459-8.7232-9.5645-14.768-11.55-5.5293-1.8534-11.426-2.328-17.225-2.1966zm-408.42 0.0547c-7.485 0.10988-15.168 1.8683-21.325 6.29-5.8963 4.1572-10.023 10.506-12.049 17.38-2.2278 7.449-2.4929 15.354-1.8048 23.056 0.74978 7.6806 3.0085 15.462 7.9093 21.557 4.2287 5.3446 10.395 8.9711 16.994 10.527 6.1192 1.4521 12.524 1.5682 18.735 0.67726 6.6654-0.9776 13.189-3.7434 18.029-8.5121 3.7515-3.6248 6.3679-8.2558 8.1993-13.104 0.0269-0.44397 0.97206-1.4482 0.14968-1.374-7.2167-0.62715-14.434-1.2534-21.65-1.8794-0.68894 2.3846-1.5805 4.8733-3.5636 6.5004-2.7449 2.2858-6.5647 2.6407-9.9891 2.2571-3.5258-0.37323-6.7616-2.5475-8.4636-5.6537-2.0819-3.6841-2.6672-7.9893-2.8352-12.157h47.162c0.11311-8.616-0.55604-17.426-3.7422-25.514-2.5945-6.6573-7.2591-12.661-13.602-16.1-5.5124-3.0466-11.916-4.0884-18.154-3.9512zm278.72 0c-7.452 0.1102-15.1 1.8499-21.243 6.233-5.9136 4.1357-10.061 10.476-12.104 17.346-2.2512 7.4753-2.5258 15.414-1.8318 23.147 0.74916 7.7216 3.036 15.545 7.9866 21.654 4.2446 5.3188 10.414 8.9151 17.007 10.452 6.0925 1.4298 12.464 1.5421 18.646 0.65501 6.8103-0.99732 13.482-3.869 18.343-8.8306 3.6239-3.5894 6.1239-8.1403 7.9227-12.876 0.0677-0.46893 0.96045-1.4402 0.016-1.2929-7.1849-0.62374-14.37-1.2477-21.555-1.8708-0.69773 2.4333-1.6275 4.9789-3.6856 6.5995-2.7405 2.1997-6.4918 2.5339-9.8672 2.1585-3.5311-0.37168-6.7689-2.5551-8.4722-5.6646-2.0694-3.6853-2.6639-7.9812-2.8266-12.146h47.162c0.10933-8.648-0.55685-17.496-3.7822-25.606-2.6478-6.7618-7.4566-12.84-13.966-16.222-5.4195-2.8878-11.665-3.8673-17.75-3.7365zm209.14 0c-7.452 0.11027-15.1 1.85-21.243 6.233-5.8855 4.1165-10.023 10.417-12.074 17.251-2.2716 7.4701-2.5505 15.409-1.8719 23.143 0.73712 7.6607 2.9634 15.424 7.8185 21.527 4.2089 5.3868 10.383 9.0552 16.999 10.631 6.148 1.4772 12.588 1.5965 18.832 0.70182 6.778-0.99269 13.416-3.8407 18.273-8.759 3.6322-3.5797 6.1545-8.1192 7.9546-12.855 0.0284-0.44503 0.97526-1.4492 0.15367-1.3767-7.2181-0.62663-14.436-1.2535-21.654-1.8794-0.69216 2.4027-1.5973 4.9112-3.6074 6.5371-2.7442 2.2535-6.5386 2.601-9.9453 2.2209-3.5607-0.37443-6.8187-2.5932-8.5147-5.7393-2.0347-3.6705-2.6226-7.9343-2.7841-12.071h47.162c0.10966-8.6467-0.55731-17.493-3.78-25.602-2.6598-6.7936-7.5024-12.899-14.057-16.272-5.3993-2.8536-11.609-3.8196-17.661-3.6902zm-356.53 3.2227v75.463h22.857v-77.336h-22.857zm29.627 0.63086c8.9216 24.944 17.845 49.887 26.766 74.832h25.479c9.5051-25.779 19.012-51.557 28.518-77.336h-24.043c-5.2971 16.266-10.669 32.508-15.811 48.824-0.43805 1.4104-0.84917 2.8293-1.2729 4.2443-1.622-5.8564-3.3118-11.693-5.1741-17.478-3.7067-11.863-7.4098-23.728-11.119-35.59h-24.238c0.29882 0.83463 0.59765 1.6693 0.89648 2.5039zm-159.48 11.936c3.1341 0.078 6.23 1.5203 8.1292 4.0465 2.2354 2.8425 3.0748 6.4904 3.4861 10.012-8.1836-3e-3 -16.378 5e-3 -24.555-4e-3 0.33069-3.9958 1.3492-8.2392 4.2754-11.16 3.5473-3.5875 8.6641-2.8949 8.6641-2.8948zm278.72 0c3.1098 0.079 6.1866 1.4951 8.0852 3.9926 2.2658 2.849 3.1153 6.522 3.53 10.066-8.1836-3e-3 -16.378 5e-3 -24.555-4e-3 0.33062-4.0285 1.3676-8.3104 4.3458-11.231 2.2513-2.2254 5.516-2.9656 8.5936-2.824zm209.14 0c3.11 0.0796 6.1864 1.495 8.0852 3.9926 2.2694 2.8479 3.1147 6.522 3.53 10.066-8.1836-3e-3 -16.378 5e-3 -24.555-4e-3 0.3324-4.0275 1.3678-8.3108 4.3458-11.231 2.2528-2.2238 5.5153-2.9664 8.5936-2.824zm-409.28 0.96096c3.1544 0.11035 6.2726 1.5401 8.2082 4.0704 3.2364 4.1401 4.247 9.5064 4.6356 14.625 0.3299 5.9758 0.14275 12.112-1.7528 17.84-1.2693 3.7404-3.5836 7.4896-7.3718 9.0641-2.9443 1.185-6.3692 1.1951-9.329 0.0568-3.5008-1.3736-5.6197-4.8241-6.7234-8.2616-1.7782-5.5693-1.9299-11.501-1.7467-17.298 0.25062-4.8469 0.79941-9.8603 3.0928-14.218 1.4456-2.8214 4.1085-5.0568 7.2697-5.621 1.2197-0.25702 2.4748-0.30763 3.7175-0.25787z' fill='%23fff'/%3E%3C/g%3E%3Cg%3E%3Cellipse transform='matrix(.9985 .054721 -.05406 .99854 0 0)' cx='172.74' cy='70.595' rx='16.678' ry='16.779' fill='%2364ff00' fill-opacity='.99597'/%3E%3Cpath d='m150.59 82.92-24.386 12.434 1.798 11.571 27.592-14.069a18.345 18.457 0 0 1-5.0039-9.936zm-38.542 19.652-57.659 29.4a18.345 18.457 0 0 1 5.0049 9.937l54.452-27.765z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%235496be' image-rendering='auto' shape-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3C/g%3E%3Cg%3E%3Cpath d='m69.169 41.959v89.464a8.2395 8.2395 45 0 0 8.2395 8.2395h7.8625a7.7066 7.7066 135 0 0 7.7066-7.7066v-22.255a5.2001 5.2001 135 0 1 5.2001-5.2001h37.059a6.778 6.778 135 0 0 6.778-6.778v-5.6833a6.7907 6.7907 45 0 0-6.7907-6.7907h-37.36a4.886 4.886 45 0 1-4.886-4.886v-17.479a3.5427 3.5427 135 0 1 3.5427-3.5427h38.695a8.3641 8.3641 135 0 0 8.3641-8.3641v-2.7356a8.1542 8.1542 45 0 0-8.1542-8.1542h-64.383a1.873 1.873 135 0 0-1.873 1.873z' fill='%23fff'/%3E%3Cpath d='m155.65 93.024-24.291 47.711a18.345 18.457 0 0 1 9.8512 5.0857l24.29-47.711a18.345 18.457 0 0 1-9.8506-5.0862z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%2330b873' image-rendering='auto' shape-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3C/g%3E%3Cpath transform='matrix(.26629 0 0 .26792 -4.299 -8.0083)' d='m476.72 125.33a68.892 68.892 0 0 1-29.471 29.332l141.27 141.81a68.892 68.892 0 0 1 29.469-29.332z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23ebe305' image-rendering='auto' shape-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26629 0 0 .26792 -4.299 -8.0083)' d='m446.93 154.83a68.892 68.892 0 0 1-34.982 7.4824 68.892 68.892 0 0 1-6.0293-0.63281l15.818 101.29 43.162 6.9258zm-16 167.03 37.4 239.48a68.892 68.892 0 0 1 33.914-6.9434 68.892 68.892 0 0 1 7.207 0.79101l-35.357-226.41z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%2357c115' image-rendering='auto' shape-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3C/svg%3E%0A">
  		<!-- CC BY-SA 4.0 - Erik Uden -->
  	</label>
  </div>
  <script>Array.prototype.forEach||(Array.prototype.forEach=function(e){var t,o;if(null==this)throw new TypeError("this is null or not defined");var n=Object(this),r=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),o=0;o<r;){var i;o in n&&(i=n[o],e.call(t,i,o,n)),o++}}),document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll(".fedi-share").forEach((function(e,t){e.querySelector(".fedi-check-toggle").id="fedi-check-toggle-"+t,e.querySelector(".fedi-check-label").htmlFor="fedi-check-toggle-"+t,e.querySelector(".fedi-share-button").addEventListener("click",(function(t){var o=new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@|\\d{1,3}(?:\\.\\d{1,3}){3}|(?:(?:[a-z\\d\\u00a1-\\uffff]+-?)*[a-z\\d\\u00a1-\\uffff]+)(?:\\.(?:[a-z\\d\\u00a1-\\uffff]+-?)*[a-z\\d\\u00a1-\\uffff]+)*(?:\\.[a-z\\u00a1-\\uffff]{2,6}))(?::\\d+)?(?:[^\\s]*)?$","i"),n=e.querySelector('input[name="fedi-instance-input"]');if(o.test(n.value)){var r=`http://${n.value.replace(/(^\w+:|^)\/\//,"")}/share?text=${encodeURIComponent(document.title)} ${encodeURIComponent(location.href)}`;window.open(r,"new","toolbar=no,location=no,status=yes,resizable=yes,scrollbars=yes,height=600,width=400")}else n.classList.add("invalid"),setTimeout((function(){n.classList.remove("invalid")}),300)})),e.addEventListener("mouseleave",(function(t){e.querySelector(".fedi-check-toggle").checked=!1}))}))}));</script>
  <style>.fedi-check-toggle{height:0;width:0;padding:0;margin:0;visibility:hidden;display:none}.fedi-check-toggle:checked + .fedi-instance{display:block !important}.fedi-check-toggle:not(:checked) + .fedi-instance{display:none}.fedi-share.active{padding-bottom:10px}.fedi-share-lg .fedi-top{cursor:pointer;position:absolute;width:142px;top:0;left:0;padding:4px 8px;z-index:1}.fedi-share-md .fedi-top,.fedi-share-sm .fedi-top{cursor:pointer;position:absolute;width:18px;height:15px;top:0;left:0;padding:4px 8px;z-index:1}.fedi-share-lg,.fedi-share-md,.fedi-share-sm{color:white;display:inline-block;height:23px;background-color:#292D37;border-radius:3px;position:relative}.fedi-share-lg{width:157px}.fedi-share-md{width:93px}.fedi-share-sm{width:34px}.fedi-share-sm .fedi-logo{background:url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='196.52mm' height='196.52mm' version='1.1' viewBox='0 0 196.52 196.52' xmlns='http://www.w3.org/2000/svg' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23'%3E%3Cmetadata%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:format%3Eimage/svg+xml%3C/dc:format%3E%3Cdc:type rdf:resource='http://purl.org/dc/dcmitype/StillImage'/%3E%3Cdc:title/%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cg transform='translate(6.679 -32.496)' shape-rendering='auto'%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m181.13 275.14a68.892 68.892 0 0 1-29.465 29.328l161.76 162.39 38.998-19.764zm213.36 214.19-38.998 19.764 81.963 82.283a68.892 68.892 0 0 1 29.471-29.332z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23a730b8' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m581.65 339.39-91.576 46.41 6.752 43.189 103.62-52.514a68.892 68.892 0 0 1-18.791-37.086zm-144.74 73.352-216.53 109.73a68.892 68.892 0 0 1 18.795 37.09l204.48-103.63z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%235496be' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m367.28 142.44-104.48 203.97 30.848 30.967 110.62-215.96a68.892 68.892 0 0 1-36.99-18.98zm-131.65 257.02-52.922 103.31a68.892 68.892 0 0 1 36.986 18.979l46.781-91.328z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23ce3d1a' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m150.77 304.92a68.892 68.892 0 0 1-34.416 7.1953 68.892 68.892 0 0 1-6.6504-0.69531l30.902 197.66a68.892 68.892 0 0 1 34.416-7.1953 68.892 68.892 0 0 1 6.6465 0.69531z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23d0188f' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m239.34 560.54a68.892 68.892 0 0 1 0.7207 13.877 68.892 68.892 0 0 1-7.2676 27.18l197.63 31.713a68.892 68.892 0 0 1-0.72266-13.879 68.892 68.892 0 0 1 7.2695-27.178z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%235b36e9' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m601.13 377.2-91.219 178.08a68.892 68.892 0 0 1 36.994 18.982l91.217-178.08a68.892 68.892 0 0 1-36.992-18.984z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%2330b873' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m476.72 125.33a68.892 68.892 0 0 1-29.471 29.332l141.27 141.81a68.892 68.892 0 0 1 29.469-29.332z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23ebe305' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m347.79 104.63-178.58 90.498a68.892 68.892 0 0 1 18.793 37.086l178.57-90.502a68.892 68.892 0 0 1-18.791-37.082z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23f47601' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m446.93 154.83a68.892 68.892 0 0 1-34.982 7.4824 68.892 68.892 0 0 1-6.0293-0.63281l15.818 101.29 43.162 6.9258zm-16 167.03 37.4 239.48a68.892 68.892 0 0 1 33.914-6.9434 68.892 68.892 0 0 1 7.207 0.79101l-35.357-226.41z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%2357c115' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3Cpath transform='matrix(.26458 0 0 .26458 -6.679 32.496)' d='m188.13 232.97a68.892 68.892 0 0 1 0.75781 14.096 68.892 68.892 0 0 1-7.1602 26.982l101.37 16.281 19.924-38.908zm173.74 27.9-19.926 38.912 239.51 38.467a68.892 68.892 0 0 1-0.69531-13.719 68.892 68.892 0 0 1 7.3496-27.324z' color='%23000000' color-rendering='auto' dominant-baseline='auto' fill='%23dbb210' image-rendering='auto' solid-color='%23000000' style='font-feature-settings:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-variant-position:normal;isolation:auto;mix-blend-mode:normal;shape-padding:0;text-decoration-color:%23000000;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-orientation:mixed;text-transform:none;white-space:normal'/%3E%3C/g%3E%3Cg transform='translate(6.679 -32.496)' fill-opacity='.99597'%3E%3Ccircle transform='rotate(3.1178)' cx='106.27' cy='51.536' r='16.571' fill='%23ffca00'/%3E%3Ccircle transform='rotate(3.1178)' cx='171.43' cy='110.19' r='16.571' fill='%2364ff00'/%3E%3Ccircle transform='rotate(3.1178)' cx='135.76' cy='190.28' r='16.571' fill='%2300a3ff'/%3E%3Ccircle transform='rotate(3.1178)' cx='48.559' cy='181.11' r='16.571' fill='%239500ff'/%3E%3Ccircle transform='rotate(3.1178)' cx='30.329' cy='95.367' r='16.571' fill='%23f00'/%3E%3C/g%3E%3C/svg%3E%0A")}.fedi-share-md .fedi-instance,.fedi-share-sm .fedi-instance{border-radius:0 3px 3px 3px;z-index:0}.fedi-instance{background-color:#292D37;padding:8px;position:absolute;top:20px;left:0;margin:0 auto;border-radius:0 0 3px 3px}.fedi-share span{vertical-align:top;font-family:sans-serif;font-weight:700;font-size:12.5px}.fedi-share img{max-height:19px;margin-top:-2px;margin-left:-0.5px}.fedi-instance input[name="fedi-instance-input"]{background-color:#00000000;border:none;color:white;border-bottom:2px solid #3087D5;font-size:14px;font-weight:700;max-width:130px}.fedi-instance input[name="fedi-instance-input"][class="invalid"]{border-bottom:2px solid red;animation-name:shake;animation-duration:100ms;animation-timing-function:ease-in-out;animation-iteration-count:infinite}@-webkit-keyframes shake{41%,8%{-webkit-transform:translateX(-10px)}25%,58%{-webkit-transform:translateX(10px)}75%{-webkit-transform:translateX(-5px)}92%{-webkit-transform:translateX(5px)}0%,100%{-webkit-transform:translateX(0)}}.fedi-share input::placeholder{color:#C7C7CD}.fedi-share input:focus{outline:none}.fedi-share button{background-color:#00000000;color:white;border:none;font-size:14px;font-weight:700;padding:0;margin:8px 0 0;cursor:pointer}.fedi-share button:hover{color:#3087d5}</style>
  <!--        AGPLv3.0        -->
  <!-- Medium Fediverse Share -->

  or <a
      href="https://bsky.app/intent/compose?text=How To Mock Functions That Have External HTTP Requests https:&#x2F;&#x2F;hermanradtke.com&#x2F;how-to-mock-functions-that-have-external-http-requests&#x2F;"
      target="_blank"
      rel="noopener noreferrer"
    >
      <svg style="width: 20px; height: auto; display: inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 568 501"><title>Bluesky butterfly logo</title><path fill="currentColor" d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C9.945 203.659 0 75.291 0 57.946 0-28.906 76.135-1.612 123.121 33.664Z"></path></svg>
      Bluesky Social
    </a>

</div>
</p>

<small>
  <span
      xmlns:dct="http://purl.org/dc/terms/"
      property="dct:title"
      >
      How To Mock Functions That Have External HTTP Requests
  </span>
    by
    <a
        xmlns:cc="http://creativecommons.org/ns#"
        href="https:&#x2F;&#x2F;hermanradtke.com&#x2F;how-to-mock-functions-that-have-external-http-requests&#x2F;"
        property="cc:attributionName"
        rel="cc:attributionURL"
        >
        Herman J. Radtke III
    </a>
      is licensed under a
      <a
          rel="license"
          href="http://creativecommons.org/licenses/by/4.0/"
          >
          Creative Commons Attribution 4.0 International License
      </a>
        .
</small>


        </footer>
    </div>
</body>
</html>
